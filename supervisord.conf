[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:nginx]
command=nginx -g "daemon off;"
autostart=true
autorestart=true
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0

[program:dockerd]
command=bash -c "rm -f /var/run/docker.pid /var/run/docker.sock && dockerd --host=unix:///var/run/docker.sock --storage-driver=vfs --iptables=false --bridge=none"
autostart=true
autorestart=false
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
priority=100
startsecs=10
startretries=3

[program:backend]
command=python3 -m gunicorn --bind 0.0.0.0:8000 --workers 1 --timeout 120 --graceful-timeout 30 app:app
directory=/app/backend
autostart=true
autorestart=true
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
environment=PORT=8000
priority=200